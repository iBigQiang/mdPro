# 升级日志文档

日期：2025-12-05

本文件记录每次功能升级的关键改动、代码位置与配套说明，便于后续快速定位与调整参数。

## PC 预览宽度优化与快捷切换按钮

- 目标：为中间预览区域提供接近公众号桌面浏览器的中栏宽度，并新增“手机/电脑”一键切换按钮。

- 关键改动：
  - packages/shared/src/configs/style.ts:115
    - 电脑端宽度由 `w-full` 调整为 `w-full max-w-[740px]`。
    - 说明：`max-w-[740px]` 限制最大宽度为 740px，同时在小屏下保持自适应填满。
    - 调整方式：如需改为 720/760/780px，只需把该处的数值改为 `max-w-[720px]`/`max-w-[760px]`/`max-w-[780px]`。

  - apps/web/src/components/editor/editor-header/index.vue
    - 引入图标与配置：顶部导入 `Monitor`、`Smartphone` 以及 `widthOptions`。
      - 位置：文件开头的 import（约第 2 行处）。
    - 状态与选项：通过 `storeToRefs(themeStore)` 读取 `previewWidth`，并定义 `mobileWidth = widthOptions[0].value`、`desktopWidth = widthOptions[1].value`。
      - 位置：脚本顶部状态区域（约第 30–40 行处）。
    - 切换函数：新增 `togglePreviewMode()`，在手机与电脑宽度之间切换，并调用 `editorRefresh()` 立即生效。
      - 位置：函数定义（约第 240 行附近）。
    - 顶部右侧按钮：在“复制”按钮左侧新增“手机/电脑”按钮，图标随当前模式变化。
      - 位置：template 右侧操作区（约第 283 行处）。

  - apps/web/src/views/CodemirrorEditor.vue:735
    - 预览容器类名绑定：非移动端直接应用 `themeStore.previewWidth`，配合 `mx-auto` 居中显示。
    - 说明：移动端仍强制 `w-full`，桌面端将受 `max-w-[740px]` 限制并居中显示。

  - apps/web/src/components/editor/editor-header/ViewDropdown.vue:70–83, 165–178
    - 视图菜单的“预览模式”子项：与 `widthOptions` 同源，和顶部按钮共用同一状态 `previewWidth`。

- 验证步骤：
  1. 启动开发环境：`pnpm web dev`
  2. 默认为“手机模式”（窄 375px）。
  3. 点击右上角“手机/电脑”按钮或通过“视图 -> 预览模式”切换到“电脑端”，中间预览呈现中栏效果（最大 740px，居中）。
  4. 刷新页面后仍保留上次选择的预览模式（本地持久化）。

- 影响范围：
  - 仅影响预览区域宽度表现；移动端不变。
  - 与复制/渲染逻辑无耦合；复制到公众号功能不受影响。

- 回退与调整：
  - 回退为旧行为：把 `packages/shared/src/configs/style.ts:115` 改回 `w-full`。
  - 调整中栏宽度：修改同一行的 `max-w[...]` 数值即可。

